<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang=en lang=en> <head> <meta http-equiv=Content-Type content="text/html; charset=utf-8"/> <title> Class: Sass::Plugin::Compiler &mdash; Sass Documentation </title> <link rel=stylesheet href="../../css/style-03d6d7d0.css" charset=utf-8 /> <link rel=stylesheet href="../../../assets/css/docs-eb9372d5.css" charset=utf-8 /> <script charset=utf-8>
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Sass/Plugin/Compiler.html";
</script> <script charset=utf-8 src="../../js/jquery-89b1e99e.js"></script> <script charset=utf-8 src="../../js/app-760e64ba.js"></script> </head> <body> <div id=header> <div id=menu> <a href="../../_index.html">Index (C)</a> &raquo; <span class=title><span class=object_link><a href="../../Sass.html" title="Sass (module)">Sass</a></span></span> &raquo; <span class=title><span class=object_link><a href="../Plugin.html" title="Sass::Plugin (module)">Plugin</a></span></span> &raquo; <span class=title>Compiler</span> <div class=noframes><span class=title>(</span><a href="." target=_top>no frames</a><span class=title>)</span></div> </div> <div id=search> <a class=full_list_link id=class_list_link href="../../class_list.html"> Class List </a> <a class=full_list_link id=method_list_link href="../../method_list.html"> Method List </a> <a class=full_list_link id=file_list_link href="../../file_list.html"> File List </a> </div> <div class=clear></div> </div> <iframe id=search_frame></iframe> <div id=content><h1>Class: Sass::Plugin::Compiler </h1> <dl class=box> <dt class=r1>Inherits:</dt> <dd class=r1> <span class=inheritName>Object</span> <ul class=fullTree> <li>Object</li> <li class=next>Sass::Plugin::Compiler</li> </ul> <a href="#" class=inheritanceTree>show all</a> </dd> <dt class=r2>Extended by:</dt> <dd class=r2><span class=object_link><a href="../Callbacks.html" title="Sass::Callbacks (module)">Callbacks</a></span></dd> <dt class=r1>Includes:</dt> <dd class=r1><span class=object_link><a href="Configuration.html" title="Sass::Plugin::Configuration (module)">Configuration</a></span></dd> <dt class="r2 last">Defined in:</dt> <dd class="r2 last">/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb</dd> </dl> <div class=clear></div> <h2>Overview</h2><div class=docstring> <div class=discussion> <p>The Compiler class handles compilation of multiple files and/or directories, including checking which CSS files are out-of-date and need to be updated and calling Sass to perform the compilation on those files.</p> <p><span class=object_link><a href="../Plugin.html" title="Sass::Plugin (module)">Sass::Plugin</a></span> uses this class to update stylesheets for a single application. Unlike <span class=object_link><a href="../Plugin.html" title="Sass::Plugin (module)">Sass::Plugin</a></span>, though, the Compiler class has no global state, and so multiple instances may be created and used independently.</p> <p>If you need to compile a Sass string into CSS, please see the <span class=object_link><a href="../Engine.html" title="Sass::Engine (class)">Engine</a></span> class.</p> <p>Unlike <span class=object_link><a href="../Plugin.html" title="Sass::Plugin (module)">Sass::Plugin</a></span>, this class doesnâ€™t keep track of whether or how many times a stylesheet should be updated. Therefore, the following <code>Sass::Plugin</code> options are ignored by the Compiler:</p> <ul> <li><code>:never_update</code></li> <li><code>:always_check</code></li> </ul> </div> </div> <div class=tags> </div> <h2> Instance Method Summary <small>(<a href="#" class=summary_toggle>collapse</a>)</small> </h2> <ul class=summary> <li class="public "> <span class=summary_signature> <a href="#clean-instance_method" title="#clean (instance method)">- <strong>clean</strong>(individual_files = []) </a> </span> <span class=summary_desc><div class=inline> <p>Remove all output files that would be created by calling update_stylesheets, if they exist.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#engine_options-instance_method" title="#engine_options (instance method)">- ({Symbol =&gt; Object}) <strong>engine_options</strong>(additional_options = {}) </a> </span> <span class=summary_desc><div class=inline> <p>Non-destructively modifies <span class=object_link><a href="Configuration.html#options-instance_method" title="Sass::Plugin::Configuration#options (method)">Sass::Plugin::Configuration#options</a></span> so that default values are properly set, and returns the result.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#file_list-instance_method" title="#file_list (instance method)">- (Array&lt;(String, String, String)&gt;) <strong>file_list</strong>(individual_files = []) </a> </span> <span class=summary_desc><div class=inline> <p>Construct a list of files that might need to be compiled from the provided individual_files and the template_locations.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#initialize-instance_method" title="#initialize (instance method)">- (Compiler) <strong>initialize</strong>(opts = {}) </a> </span> <span class="note title constructor">constructor</span> <span class=summary_desc><div class=inline> <p>Creates a new compiler.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#stylesheet_needs_update%3F-instance_method" title="#stylesheet_needs_update? (instance method)">- (Boolean) <strong>stylesheet_needs_update?</strong>(css_file, template_file) </a> </span> <span class=summary_desc><div class=inline> <p>Compass expects this to exist.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#update_stylesheets-instance_method" title="#update_stylesheets (instance method)">- <strong>update_stylesheets</strong>(individual_files = []) </a> </span> <span class=summary_desc><div class=inline> <p>Updates out-of-date stylesheets.</p> </div></span> </li> <li class="public "> <span class=summary_signature> <a href="#watch-instance_method" title="#watch (instance method)">- <strong>watch</strong>(individual_files = [], options = {}) </a> </span> <span class=summary_desc><div class=inline> <p>Watches the template directory (or directories) and updates the CSS files whenever the related Sass/SCSS files change.</p> </div></span> </li> </ul> <h3 class=inherited>Methods included from <span class=object_link><a href="../Callbacks.html" title="Sass::Callbacks (module)">Callbacks</a></span></h3> <p class=inherited><span class=object_link><a href="../Callbacks.html#define_callback-instance_method" title="Sass::Callbacks#define_callback (method)">define_callback</a></span>, <span class=object_link><a href="../Callbacks.html#extended-class_method" title="Sass::Callbacks.extended (method)">extended</a></span></p> <h3 class=inherited>Methods included from <span class=object_link><a href="Configuration.html" title="Sass::Plugin::Configuration (module)">Configuration</a></span></h3> <p class=inherited><span class=object_link><a href="Configuration.html#add_template_location-instance_method" title="Sass::Plugin::Configuration#add_template_location (method)">#add_template_location</a></span>, <span class=object_link><a href="Configuration.html#default_options-instance_method" title="Sass::Plugin::Configuration#default_options (method)">#default_options</a></span>, <span class=object_link><a href="Configuration.html#options-instance_method" title="Sass::Plugin::Configuration#options (method)">#options</a></span>, <span class=object_link><a href="Configuration.html#remove_template_location-instance_method" title="Sass::Plugin::Configuration#remove_template_location (method)">#remove_template_location</a></span>, <span class=object_link><a href="Configuration.html#reset%21-instance_method" title="Sass::Plugin::Configuration#reset! (method)">#reset!</a></span>, <span class=object_link><a href="Configuration.html#template_location_array-instance_method" title="Sass::Plugin::Configuration#template_location_array (method)">#template_location_array</a></span></p> <div id=constructor_details class=method_details_list> <h2>Constructor Details</h2> <div class="method_details first"> <h3 class="signature first" id=initialize-instance_method> - (<tt><span class=object_link><a href="" title="Sass::Plugin::Compiler (class)">Compiler</a></span></tt>) <strong>initialize</strong>(opts = {}) </h3><div class=docstring> <div class=discussion> <p>Creates a new compiler.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>opts</span> <span class=type>(<tt>{Symbol =&gt; Object}</tt>)</span> <em class=default>(defaults to: <tt>{}</tt>)</em> &mdash; <div class=inline> <p>See <a href="../../file.SASS_REFERENCE.html#sass_options" title="the Sass options documentation">the Sass options documentation</a>.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


35
36
37
38</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb', line 35</span>

def initialize(opts = {})
  @watched_files = Set.new
  options.merge!(opts)
end</pre> </td> </tr> </table> </div> </div> <div id=instance_method_details class=method_details_list> <h2>Instance Method Details</h2> <div class="method_details first"> <h3 class="signature first" id=clean-instance_method> - <strong>clean</strong>(individual_files = []) </h3><div class=docstring> <div class=discussion> <p>Remove all output files that would be created by calling update_stylesheets, if they exist.</p> <p>This method runs the deleting_css and deleting_sourcemap callbacks for the files that are deleted.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>individual_files</span> <span class=type>(<tt>Array&lt;(String, String[, String])&gt;</tt>)</span> <em class=default>(defaults to: <tt>[]</tt>)</em> &mdash; <div class=inline> <p>A list of files to check for updates <strong>in addition to those specified by the <a href="../../file.SASS_REFERENCE.html#template_location-option" title="&lt;code&gt;:template_location&lt;/code&gt; option"><code>:template_location</code> option</a>.</strong> The first string in each pair is the location of the Sass/SCSS file, the second is the location of the CSS file that it should be compiled to. The third string, if provided, is the location of the Sourcemap file.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


371
372
373
374
375
376
377
378
379
380
381
382
383</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb', line 371</span>

def clean(individual_files = [])
  file_list(individual_files).each do |(_, css_file, sourcemap_file)|
    if File.exist?(css_file)
      run_deleting_css css_file
      File.delete(css_file)
    end
    if sourcemap_file &amp;&amp; File.exist?(sourcemap_file)
      run_deleting_sourcemap sourcemap_file
      File.delete(sourcemap_file)
    end
  end
  nil
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id=engine_options-instance_method> - (<tt>{Symbol =&gt; Object}</tt>) <strong>engine_options</strong>(additional_options = {}) </h3><div class=docstring> <div class=discussion> <p>Non-destructively modifies <span class=object_link><a href="Configuration.html#options-instance_method" title="Sass::Plugin::Configuration#options (method)">Sass::Plugin::Configuration#options</a></span> so that default values are properly set, and returns the result.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>additional_options</span> <span class=type>(<tt>{Symbol =&gt; Object}</tt>)</span> <em class=default>(defaults to: <tt>{}</tt>)</em> &mdash; <div class=inline> <p>An options hash with which to merge <span class=object_link><a href="Configuration.html#options-instance_method" title="Sass::Plugin::Configuration#options (method)">Sass::Plugin::Configuration#options</a></span></p> </div> </li> </ul> <p class=tag_title>Returns:</p> <ul class=return> <li> <span class=type>(<tt>{Symbol =&gt; Object}</tt>)</span> &mdash; <div class=inline> <p>The modified options hash</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


346
347
348
349
350
351
352</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb', line 346</span>

def engine_options(additional_options = {})
  opts = options.merge(additional_options)
  opts[:load_paths] = load_paths(opts)
  options[:sourcemap] = :auto if options[:sourcemap] == true
  options[:sourcemap] = :none if options[:sourcemap] == false
  opts
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id=file_list-instance_method> - (<tt>Array&lt;(String, String, String)&gt;</tt>) <strong>file_list</strong>(individual_files = []) </h3><div class=docstring> <div class=discussion> <p>Construct a list of files that might need to be compiled from the provided individual_files and the template_locations.</p> <p>Note: this method does not cache the results as they can change across invocations when sass files are added or removed.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>individual_files</span> <span class=type>(<tt>Array&lt;(String, String[, String])&gt;</tt>)</span> <em class=default>(defaults to: <tt>[]</tt>)</em> &mdash; <div class=inline> <p>A list of files to check for updates <strong>in addition to those specified by the <a href="../../file.SASS_REFERENCE.html#template_location-option" title="&lt;code&gt;:template_location&lt;/code&gt; option"><code>:template_location</code> option</a>.</strong> The first string in each pair is the location of the Sass/SCSS file, the second is the location of the CSS file that it should be compiled to. The third string, if provided, is the location of the Sourcemap file.</p> </div> </li> </ul> <p class=tag_title>Returns:</p> <ul class=return> <li> <span class=type>(<tt>Array&lt;(String, String, String)&gt;</tt>)</span> &mdash; <div class=inline> <p>A list of [sass_file, css_file, sourcemap_file] tuples similar to what was passed in, but expanded to include the current state of the directories being updated.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb', line 240</span>

def file_list(individual_files = [])
  files = individual_files.map do |tuple|
    if engine_options[:sourcemap] == :none
      tuple[0..1]
    elsif tuple.size &lt; 3
      [tuple[0], tuple[1], Sass::Util.sourcemap_name(tuple[1])]
    else
      tuple.dup
    end
  end

  template_location_array.each do |template_location, css_location|
    Sass::Util.glob(File.join(template_location, &quot;**&quot;, &quot;[^_]*.s[ca]ss&quot;)).sort.each do |file|
      # Get the relative path to the file
      name = Sass::Util.relative_path_from(file, template_location).to_s
      css = css_filename(name, css_location)
      sourcemap = Sass::Util.sourcemap_name(css) unless engine_options[:sourcemap] == :none
      files &lt;&lt; [file, css, sourcemap]
    end
  end
  files
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id="stylesheet_needs_update?-instance_method"> - (<tt>Boolean</tt>) <strong>stylesheet_needs_update?</strong>(css_file, template_file) </h3><div class=docstring> <div class=discussion> <p>Compass expects this to exist</p> </div> </div> <div class=tags> <p class=tag_title>Returns:</p> <ul class=return> <li> <span class=type>(<tt>Boolean</tt>)</span> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


355
356
357</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb', line 355</span>

def stylesheet_needs_update?(css_file, template_file)
  StalenessChecker.stylesheet_needs_update?(css_file, template_file)
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id=update_stylesheets-instance_method> - <strong>update_stylesheets</strong>(individual_files = []) </h3><div class=docstring> <div class=discussion> <p>Updates out-of-date stylesheets.</p> <p>Checks each Sass/SCSS file in <a href="../../file.SASS_REFERENCE.html#template_location-option" title="&lt;code&gt;:template_location&lt;/code&gt;"><code>:template_location</code></a> to see if itâ€™s been modified more recently than the corresponding CSS file in <a href="../../file.SASS_REFERENCE.html#css_location-option" title="&lt;code&gt;:css_location&lt;/code&gt;"><code>:css_location</code></a>. If it has, it updates the CSS file.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>individual_files</span> <span class=type>(<tt>Array&lt;(String, String[, String])&gt;</tt>)</span> <em class=default>(defaults to: <tt>[]</tt>)</em> &mdash; <div class=inline> <p>A list of files to check for updates <strong>in addition to those specified by the <a href="../../file.SASS_REFERENCE.html#template_location-option" title="&lt;code&gt;:template_location&lt;/code&gt; option"><code>:template_location</code> option</a>.</strong> The first string in each pair is the location of the Sass/SCSS file, the second is the location of the CSS file that it should be compiled to. The third string, if provided, is the location of the Sourcemap file.</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb', line 201</span>

def update_stylesheets(individual_files = [])
  Sass::Plugin.checked_for_updates = true
  staleness_checker = StalenessChecker.new(engine_options)

  files = file_list(individual_files)
  run_updating_stylesheets(files)

  updated_stylesheets = []
  files.each do |file, css, sourcemap|
    # TODO: Does staleness_checker need to check the sourcemap file as well?
    if options[:always_update] || staleness_checker.stylesheet_needs_update?(css, file)
      # XXX For consistency, this should return the sourcemap too, but it would
      # XXX be an API change.
      updated_stylesheets &lt;&lt; [file, css]
      update_stylesheet(file, css, sourcemap)
    else
      run_not_updating_stylesheet(file, css, sourcemap)
    end
  end
  run_updated_stylesheets(updated_stylesheets)
end</pre> </td> </tr> </table> </div> <div class="method_details "> <h3 class="signature " id=watch-instance_method> - <strong>watch</strong>(individual_files = [], options = {}) </h3><div class=docstring> <div class=discussion> <p>Watches the template directory (or directories) and updates the CSS files whenever the related Sass/SCSS files change. <code>watch</code> never returns.</p> <p>Whenever a change is detected to a Sass/SCSS file in <a href="../../file.SASS_REFERENCE.html#template_location-option" title="&lt;code&gt;:template_location&lt;/code&gt;"><code>:template_location</code></a>, the corresponding CSS file in <a href="../../file.SASS_REFERENCE.html#css_location-option" title="&lt;code&gt;:css_location&lt;/code&gt;"><code>:css_location</code></a> will be recompiled. The CSS files of any Sass/SCSS files that import the changed file will also be recompiled.</p> <p>Before the watching starts in earnest, <code>watch</code> calls <span class=object_link><a href="#update_stylesheets-instance_method" title="Sass::Plugin::Compiler#update_stylesheets (method)">#update_stylesheets</a></span>.</p> <p>Note that <code>watch</code> uses the <a href="//github.com/guard/listen">Listen</a> library to monitor the filesystem for changes. Listen isnâ€™t loaded until <code>watch</code> is run. The version of Listen distributed with Sass is loaded by default, but if another version has already been loaded that will be used instead.</p> </div> </div> <div class=tags> <p class=tag_title>Parameters:</p> <ul class=param> <li> <span class=name>individual_files</span> <span class=type>(<tt>Array&lt;(String, String[, String])&gt;</tt>)</span> <em class=default>(defaults to: <tt>[]</tt>)</em> &mdash; <div class=inline> <p>A list of files to check for updates <strong>in addition to those specified by the <a href="../../file.SASS_REFERENCE.html#template_location-option" title="&lt;code&gt;:template_location&lt;/code&gt; option"><code>:template_location</code> option</a>.</strong> The first string in each pair is the location of the Sass/SCSS file, the second is the location of the CSS file that it should be compiled to. The third string, if provided, is the location of the Sourcemap file.</p> </div> </li> <li> <span class=name>options</span> <span class=type>(<tt>Hash</tt>)</span> <em class=default>(defaults to: <tt>{}</tt>)</em> &mdash; <div class=inline> <p>The options that control how watching works.</p> </div> </li> </ul> <p class=tag_title>Options Hash (<tt>options</tt>):</p> <ul class=option> <li> <span class=name>:skip_initial_update</span> <span class=type>(<tt>Boolean</tt>)</span> <span class=default> </span> &mdash; <div class=inline> <p>Donâ€™t do an initial update when starting the watcher when true</p> </div> </li> </ul> </div><table class=source_code> <tr> <td> <pre class=lines>


291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339</pre> </td> <td> <pre class=code><span class="info file"># File '/home/nweiz/code/sass-site/.sass/lib/sass/plugin/compiler.rb', line 291</span>

def watch(individual_files = [], options = {})
  options, individual_files = individual_files, [] if individual_files.is_a?(Hash)
  update_stylesheets(individual_files) unless options[:skip_initial_update]

  directories = watched_paths
  individual_files.each do |(source, _, _)|
    source = File.expand_path(source)
    @watched_files &lt;&lt; Sass::Util.realpath(source).to_s
    directories &lt;&lt; File.dirname(source)
  end
  directories = remove_redundant_directories(directories)

  # A Listen version prior to 2.0 will write a test file to a directory to
  # see if a watcher supports watching that directory. That breaks horribly
  # on read-only directories, so we filter those out.
  unless Sass::Util.listen_geq_2?
    directories = directories.select {|d| File.directory?(d) &amp;&amp; File.writable?(d)}
  end

  # TODO: Keep better track of what depends on what
  # so we don&#39;t have to run a global update every time anything changes.
  # XXX The :additional_watch_paths option exists for Compass to use until
  # a deprecated feature is removed. It may be removed without warning.
  listener_args = directories +
                  Array(options[:additional_watch_paths]) +
                  [{:relative_paths =&gt; false}]

  # The native windows listener is much slower than the polling option, according to
  # https://github.com/nex3/sass/commit/a3031856b22bc834a5417dedecb038b7be9b9e3e
  poll = @options[:poll] || Sass::Util.windows?
  if poll &amp;&amp; Sass::Util.listen_geq_2?
    # In Listen 2.0.0 and on, :force_polling is an option. In earlier
    # versions, it&#39;s a method on the listener (called below).
    listener_args.last[:force_polling] = true
  end

  listener = create_listener(*listener_args) do |modified, added, removed|
    on_file_changed(individual_files, modified, added, removed)
    yield(modified, added, removed) if block_given?
  end

  if poll &amp;&amp; !Sass::Util.listen_geq_2?
    # In Listen 2.0.0 and on, :force_polling is an option (set above). In
    # earlier versions, it&#39;s a method on the listener.
    listener.force_polling(true)
  end

  listen_to(listener)
end</pre> </td> </tr> </table> </div> </div> </div> <div id=footer> Generated on Thu Feb 26 18:31:08 2015 by <a href="//yardoc.org" title="Yay! A Ruby Documentation Tool" target=_parent>yard</a> 0.8.7.4 (ruby-2.0.0). </div> </body> </html>